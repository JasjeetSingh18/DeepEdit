{% extends "layout.html" %} {% block title %} Edit {% endblock %} {% block main
%}
<div class="container glass-container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 text-center">
      <h1 class="display-4 gradient-text mb-3">Edit Your Photo</h1>
      <p class="lead text-muted mb-4 text-white-50">
        Use the tools below to enhance your photo. Click and drag to select crop
        area.
      </p>

      <div
        class="mb-4"
        style="position: relative; display: inline-block"
        id="photo-container"
      >
        <img
          src="{{ url_for('static', filename='uploads/' + fileName) }}"
          alt="Uploaded Photo"
          class="img-fluid rounded shadow"
          id="photo"
        />
        <div id="cropArea"></div>
        <div class="crop-overlay" id="cropOverlay"></div>
      </div>

      <!-- Normal editing buttons -->
      <div id="normalButtons" class="d-flex justify-content-center mb-4 gap-2">
        <button class="btn btn-primary me-2" onclick="applyFilter()">Apply Filter</button>
        <button class="btn btn-primary me-2" onclick="adjustBrightness()">
          Adjust Brightness
        </button>
        <button class="btn btn-primary me-2" onclick="startCropMode()">
          Crop
        </button>
        <button class="btn btn-secondary me-2" disabled>
          Enhance With AI
        </button>
        <button
          class="btn btn-success"
          onclick="downloadPhoto('{{ fileName }}')"
        >
          Download
        </button>
        <button
          class="btn me-2"
          style="color: white; background-color: red; margin-left: 8px"
          onclick="RevertImage()"
        >
          Revert
        </button>
      </div>

      <!-- Crop mode buttons (hiddent) -->
      <div id="cropButtons" class="justify-content-center mb-4 gap-2 hidden">
        <button class="btn btn-success me-2" onclick="finishCrop()">
          Finish Crop
        </button>
        <button class="btn btn-secondary me-2" onclick="cancelCrop()">
          Cancel
        </button>
      </div>

      <!-- Brightness buttons (hidden)-->
      <div
        id="brightnessButtons"
        class="justify-content-center mb-4 gap-2 hidden"
      >
      <input
        type="range"
        class="brightness-slider"
        min="0"
        max="100"
        value="100"
        step="1"
        oninput="updateBrightness(this.value)"
      ></input>
      <div>
        <button class="btn btn-success me-2" onclick="applyBrightness()">
                Apply
                </button>
        <button class="btn btn-secondary me-2" onclick="cancelBrightness()">
        Cancel
        </button>
      </div>
      </div>

      <!-- Filter options -->
      <div id="filterOptions" class="mt-4 hidden">
        <h5 class="text-white-50">Choose a Filter:</h5>
        <div class="d-flex overflow-auto filter-scroll" style="white-space: nowrap;">
            <form class="d-flex">
            {% for filter in filters %}
            <div class="filter-option me-3 flex-shrink-0 text-center" style="min-width: 100px;">
                <label for="filter-{{ filter.name }}" class="cursor-pointer">
                <img src="{{ url_for('static', filename=filter.image) }}" 
                    alt="{{ filter.name }}" 
                    class="img-fluid mb-1 filter-image" 
                    style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"
                    onmouseenter="previewFilter('{{ filter.name }}', fileName)"
                    onmouseleave="resetPreview()" />
                <div>
                    <p class="text-white small mb-1">{{ filter.name }}</p>
                    <input type="radio" name="filter" value="{{ filter.name }}" id="filter-{{ filter.name }}" />
                </div>
                </label>
            </div>
            {% endfor %}
            </form>
        </div>
        <div class="mt-3">
            <button class="btn btn-success me-2" onclick="applySelectedFilter()">Apply Filter</button>
            <button class="btn btn-secondary" onclick="cancelFilter()">Cancel</button>
        </div>
        </div>

      <!-- Status message div -->
      <div id="status" class="text-white-50 mt-3"></div>
    </div>
  </div>
</div>

<style>
  #photo {
    max-width: 500px;
    cursor: default;
    user-select: none;
  }

  #photo.crop-mode {
    cursor: crosshair;
  }

  #cropArea {
    position: absolute;
    border: 2px dashed #fff;
    background: rgba(255, 255, 255, 0.1);
    z-index: 9999;
    display: none;
    pointer-events: none;
  }

  #photo-container {
    user-select: none;
  }

  .crop-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    pointer-events: none;
  }

  .hidden {
    display: none !important;
  }

  .show-flex {
    display: flex !important;
  }

  .filter-scroll::-webkit-scrollbar {
   height: 8px;
 }
 
 .filter-scroll::-webkit-scrollbar-track {
   background: rgba(255, 255, 255, 0.1);
   border-radius: 10px;
 }
 
 .filter-scroll::-webkit-scrollbar-thumb {
   background: linear-gradient(45deg, #667eea, #764ba2);
   border-radius: 10px;
 }
 
 .filter-scroll::-webkit-scrollbar-thumb:hover {
   background: linear-gradient(45deg, #764ba2, #667eea);
 }
 
 /* Clickable cursor and hover effects */
 .cursor-pointer {
   cursor: pointer;
 }
 
 .filter-image:hover {
   transform: scale(1.05);
   transition: transform 0.2s ease;
   box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
 }
 
 /* Selected filter styling */
 input[type="radio"]:checked + .filter-image,
 input[type="radio"]:checked ~ .filter-image {
   border: 2px solid #667eea;
   box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
 }
</style>

<script>
  const fileName = "{{ fileName }}";
  const baseUploadsUrl = "{{ url_for('static', filename='uploads/') }}";
  const originalImageUrl = "{{ url_for('static', filename='uploads/' + fileName) }}";
</script>
<script src="/static/JavaScript/edit.js"></script>
{% endblock %}
